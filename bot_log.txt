ğŸ”‘ Inicializando servidor de WhatsApp con las siguientes credenciales:
ğŸ“± GUPSHUP_NUMBER: 15557033313
ğŸ”‘ GUPSHUP_API_KEY: sk_58a31...a6e6b
ğŸ‘¤ GUPSHUP_USERID: crxty1qf...
ğŸ”— SUPABASE_URL: https://wscijkxwevgxbgwhbqtm.supabase.co
ğŸ–¥ï¸ CONTROL_PANEL_URL: http://localhost:3010/api/register-bot-response
ğŸ“¢ GLOBAL-PATCH: Verificando variables al inicio:
- CONTROL_PANEL_URL: http://localhost:3010/api/register-bot-response
- NODE_ENV: development
- RENDER: no definido
âœ… Usando SUPABASE_URL desde variable de entorno
âœ… Usando SUPABASE_KEY desde variable de entorno
âœ… Usando BUSINESS_ID desde variable de entorno
âœ… node-fetch cargado exitosamente
ğŸ”„ Inicializando cliente Supabase...
âœ… Cliente Supabase inicializado correctamente
ğŸ” FIX-REAL-BOT: Estado de URL antes de procesar:
- CONTROL_PANEL_URL: http://localhost:3010/api/register-bot-response
- NODE_ENV: development
- RENDER: no definido
ğŸ” FIX-REAL-BOT: Usando selecciÃ³n de URL para entorno de desarrollo
ğŸŒ Ambiente de DESARROLLO detectado - Intentando URL local
ğŸ” Verificando disponibilidad de servidor local en desarrollo: disponible
âš ï¸ Detectada URL con ruta incluida. Corrigiendo para usar solo el dominio base...
âš ï¸ URL original: http://localhost:3010/api/register-bot-response
âœ… URL corregida a dominio base: http://localhost:3010
âœ… URL base guardada en variable de entorno
ğŸŒ Ambiente de DESARROLLO detectado - Intentando URL local
ğŸ” Verificando disponibilidad de servidor local en desarrollo: disponible
ğŸ”§ APLICANDO PARCHE PARA CORREGIR URLs DEL BOT WHATSAPP
CONTROL_PANEL_URL actual: http://localhost:3010
Ambiente: Desarrollo
URL que se usarÃ¡: http://localhost:3010
ğŸ“¡ VERIFICACIÃ“N DE ACCESO A SUPABASE
ğŸ” Intentando acceder a Supabase (https://wscijkxwevgxbgwhbqtm.supabase.co) con Axios...
ğŸ“Œ GLOBAL-PATCH: URL final: http://localhost:3010
ğŸ”§ PARCHE GLOBAL APLICADO
âœ… FunciÃ³n global.registerBotResponse definida
â„¹ï¸ Guardando mensajes en Supabase: https://wscijkxwevgxbgwhbqtm.supabase.co
ğŸ”§ APLICANDO PARCHE PARA CORREGIR URLs DEL BOT WHATSAPP
Ambiente: Desarrollo
Render detectado: NO
CONTROL_PANEL_URL actual: http://localhost:3010
URL final que se usarÃ¡: http://localhost:3010/register-bot-response
âœ… Parche aplicado correctamente
ğŸ“ De ahora en adelante, las URLs duplicadas serÃ¡n corregidas automÃ¡ticamente
ğŸŒ En ambiente de producciÃ³n, se usarÃ¡: URL de desarrollo
ğŸ” TambiÃ©n puedes usar la funciÃ³n global registerBotResponse() para enviar mensajes
ğŸ”‘ API Keys cargadas:
OPENAI_API_KEY: âœ… OK
GUPSHUP_API_KEY: âœ… OK
GUPSHUP_NUMBER: âœ… OK
GUPSHUP_USERID: âœ… OK
CONTROL_PANEL_URL: http://localhost:3010/register-bot-response
ğŸ”‘ DEBUG - Variables de entorno para Supabase:
- SUPABASE_URL: https://wscijkxwevgxbgwhbqtm.supabase.co
- SUPABASE_ANON_KEY: eyJhbGciOi...
- SUPABASE_KEY: eyJhbGciOi...
- NEXT_PUBLIC_SUPABASE_ANON_KEY: no definido
âœ… Credenciales de Supabase encontradas correctamente
ğŸ”‘ Usando clave de Supabase (primeros 10 caracteres): eyJhbGciOi...
ğŸš€ Servidor iniciado en puerto 3090
ğŸ¤– Bot conectado al panel: http://localhost:3010/register-bot-response
ğŸ” Verificando credenciales de integraciÃ³n...
âœ… Credenciales de GupShup presentes:
  - API Key: sk_58a31...
  - NÃºmero de origen: 15557033313
  - User ID: crxty1qf...
âœ… Clave API de OpenAI configurada: sk-svcac...
ğŸ”„ Inicializando mapeos y estados...
ğŸ”„ Actualizando mapeos de conversaciones y nÃºmeros...
ğŸ” Encontradas 22 conversaciones para mapeo
âœ… Mapeos actualizados: 16 nÃºmeros mapeados
ğŸ”„ Cargando estados de bot activo...
âœ… SUPABASE ACCESIBLE VIA AXIOS: 200
âœ… CONTENIDO DE RESPUESTA: [{"id":"9471be7e-1cd5-4b96-abaa-58749f1a5d3e","user_id":"4a42aa05-2ffd-418b-aa52-29e7c571eee8","busi...
ğŸ” Intentando acceder a Supabase (https://wscijkxwevgxbgwhbqtm.supabase.co) con Fetch nativo...
â„¹ï¸ Bot para 4a42aa05-2ffd-418b-aa52-29e7c571eee8: ACTIVO
â„¹ï¸ Bot para 5491123456789: ACTIVO
â„¹ï¸ Bot para +12223334444: ACTIVO
â„¹ï¸ Bot para +19876543210: ACTIVO
â„¹ï¸ Bot para +5493513123456: ACTIVO
â„¹ï¸ Bot para 522221192568: ACTIVO
â„¹ï¸ Bot para test: ACTIVO
â„¹ï¸ Bot para +15557033313: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para ARCHIVED_92568: ACTIVO
â„¹ï¸ Bot para 5212221192568_TEST_2: ACTIVO
â„¹ï¸ Bot para +11234567890: INACTIVO
â„¹ï¸ Bot para 5219876543210: ACTIVO
â„¹ï¸ Bot para 5212221192568: INACTIVO
â„¹ï¸ Bot para 5219999888777: ACTIVO
â„¹ï¸ Bot para 5212213647963: INACTIVO
â„¹ï¸ Bot para +5213341495625: ACTIVO
âœ… Estados de bot cargados para 16 conversaciones
âœ… SUPABASE ACCESIBLE VIA FETCH NATIVO: 200
âœ… CONTENIDO DE RESPUESTA: [{"id":"9471be7e-1cd5-4b96-abaa-58749f1a5d3e","user_id":"4a42aa05-2ffd-418b-aa52-29e7c571eee8","busi...
ğŸ” Intentando acceder a Supabase (https://wscijkxwevgxbgwhbqtm.supabase.co) con node-fetch...
âœ… SUPABASE ACCESIBLE VIA NODE-FETCH: 200
âœ… CONTENIDO DE RESPUESTA: [{"id":"9471be7e-1cd5-4b96-abaa-58749f1a5d3e","user_id":"4a42aa05-2ffd-418b-aa52-29e7c571eee8","busi...
ğŸ“¡ FIN DE VERIFICACIÃ“N DE ACCESO A SUPABASE
ğŸ”„ POST /api/send-manual-message - Origin: Unknown
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212213647963","message":"Test message with DEBUG","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212213647963 { tieneMedia: false, longitudMensaje: 23, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212213647963: Test message with DEBUG
ğŸ” [TARGET] Intento de envÃ­o a nÃºmero problemÃ¡tico: 5212213647963
ğŸ” [TARGET] Texto del mensaje: "Test message with DEBUG"
ğŸ” [TARGET] NÃºmero corregido (quitando 1): 522213647963
ğŸ” [TARGET] NÃºmero limpio final: 522213647963
ğŸ” [TARGET] GUPSHUP_NUMBER: 15557033313
ğŸ” [TARGET] GUPSHUP_USERID: crxty1qflktvwvm7sodtrfe9dpvoowm1
ğŸ” [TARGET] API Key configurada: SÃ
ğŸ” [TARGET] URL de la API: https://api.gupshup.io/wa/api/v1/msg
ğŸ” [TARGET] Headers: {
  "Cache-Control": "no-cache",
  "Content-Type": "application/x-www-form-urlencoded",
  "apikey": "sk_58a31041fdeb4d98b9f0e073792a6e6b",
  "userid": "crxty1qflktvwvm7sodtrfe9dpvoowm1"
}
ğŸ” [TARGET] Datos del formulario: channel=whatsapp&source=15557033313&destination=522213647963&src.name=15557033313&message=%7B%22type%22%3A%22text%22%2C%22text%22%3A%22Test+message+with+DEBUG%22%7D
ğŸ“¤ Enviando mensaje a GupShup para 522213647963: "Test message with DEBUG..."
ğŸ” [TARGET] Intento 1/3
ğŸ” [TARGET] Respuesta de GupShup: {
  "status": "submitted",
  "messageId": "29e8fcf2-0e00-4e7d-8bb0-be75741d6aae"
}
ğŸ” [TARGET] CÃ³digo de estado: 202
âœ… Mensaje enviado correctamente a 522213647963 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212213647963 (modo forzado)
ğŸ”„ POST /api/send-manual-message - Origin: Unknown
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212221192568","message":"Test working number","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212221192568 { tieneMedia: false, longitudMensaje: 19, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212221192568: Test working number
ğŸ“¤ Enviando mensaje a GupShup para 522221192568: "Test working number..."
âœ… Mensaje enviado correctamente a 522221192568 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212221192568 (modo forzado)
ğŸ”„ GET /api/status - Origin: http://localhost:3001
ğŸ“¥ GET /api/status
ğŸ”„ POST /api/send-manual-message - Origin: http://localhost:3001
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212221192568","message":"5212213647963","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212221192568 { tieneMedia: false, longitudMensaje: 13, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212221192568: 5212213647963
ğŸ“¤ Enviando mensaje a GupShup para 522221192568: "5212213647963..."
âœ… Mensaje enviado correctamente a 522221192568 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212221192568 (modo forzado)
ğŸ”„ GET /api/status - Origin: http://localhost:3001
ğŸ“¥ GET /api/status
ğŸ”„ POST /api/send-manual-message - Origin: http://localhost:3001
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212213647963","message":"hola","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212213647963 { tieneMedia: false, longitudMensaje: 4, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212213647963: hola
ğŸ” [TARGET] Intento de envÃ­o a nÃºmero problemÃ¡tico: 5212213647963
ğŸ” [TARGET] Texto del mensaje: "hola"
ğŸ” [TARGET] NÃºmero corregido (quitando 1): 522213647963
ğŸ” [TARGET] NÃºmero limpio final: 522213647963
ğŸ” [TARGET] GUPSHUP_NUMBER: 15557033313
ğŸ” [TARGET] GUPSHUP_USERID: crxty1qflktvwvm7sodtrfe9dpvoowm1
ğŸ” [TARGET] API Key configurada: SÃ
ğŸ” [TARGET] URL de la API: https://api.gupshup.io/wa/api/v1/msg
ğŸ” [TARGET] Headers: {
  "Cache-Control": "no-cache",
  "Content-Type": "application/x-www-form-urlencoded",
  "apikey": "sk_58a31041fdeb4d98b9f0e073792a6e6b",
  "userid": "crxty1qflktvwvm7sodtrfe9dpvoowm1"
}
ğŸ” [TARGET] Datos del formulario: channel=whatsapp&source=15557033313&destination=522213647963&src.name=15557033313&message=%7B%22type%22%3A%22text%22%2C%22text%22%3A%22hola%22%7D
ğŸ“¤ Enviando mensaje a GupShup para 522213647963: "hola..."
ğŸ” [TARGET] Intento 1/3
ğŸ” [TARGET] Respuesta de GupShup: {
  "status": "submitted",
  "messageId": "ea280dcc-a036-486f-84d6-74bc40d379bb"
}
ğŸ” [TARGET] CÃ³digo de estado: 202
âœ… Mensaje enviado correctamente a 522213647963 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212213647963 (modo forzado)
ğŸ”„ GET /api/status - Origin: http://localhost:3001
ğŸ“¥ GET /api/status
ğŸ”„ POST /api/send-manual-message - Origin: http://localhost:3001
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212213647963","message":"ahora te llga","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212213647963 { tieneMedia: false, longitudMensaje: 13, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212213647963: ahora te llga
ğŸ” [TARGET] Intento de envÃ­o a nÃºmero problemÃ¡tico: 5212213647963
ğŸ” [TARGET] Texto del mensaje: "ahora te llga"
ğŸ” [TARGET] NÃºmero corregido (quitando 1): 522213647963
ğŸ” [TARGET] NÃºmero limpio final: 522213647963
ğŸ” [TARGET] GUPSHUP_NUMBER: 15557033313
ğŸ” [TARGET] GUPSHUP_USERID: crxty1qflktvwvm7sodtrfe9dpvoowm1
ğŸ” [TARGET] API Key configurada: SÃ
ğŸ” [TARGET] URL de la API: https://api.gupshup.io/wa/api/v1/msg
ğŸ” [TARGET] Headers: {
  "Cache-Control": "no-cache",
  "Content-Type": "application/x-www-form-urlencoded",
  "apikey": "sk_58a31041fdeb4d98b9f0e073792a6e6b",
  "userid": "crxty1qflktvwvm7sodtrfe9dpvoowm1"
}
ğŸ” [TARGET] Datos del formulario: channel=whatsapp&source=15557033313&destination=522213647963&src.name=15557033313&message=%7B%22type%22%3A%22text%22%2C%22text%22%3A%22ahora+te+llga%22%7D
ğŸ“¤ Enviando mensaje a GupShup para 522213647963: "ahora te llga..."
ğŸ” [TARGET] Intento 1/3
ğŸ” [TARGET] Respuesta de GupShup: {
  "status": "submitted",
  "messageId": "c5c0c245-2d7b-4eac-bdbf-16df83d5fb40"
}
ğŸ” [TARGET] CÃ³digo de estado: 202
âœ… Mensaje enviado correctamente a 522213647963 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212213647963 (modo forzado)
ğŸ”„ GET /api/status - Origin: http://localhost:3001
ğŸ“¥ GET /api/status
ğŸ”„ POST /api/send-manual-message - Origin: http://localhost:3001
ğŸ“¥ POST /api/send-manual-message
ğŸ“ Recibida solicitud para enviar mensaje manual: {"phoneNumber":"5212213647963","message":"te amoo","forceManual":true}
âš™ï¸ Procesando mensaje manual para 5212213647963 { tieneMedia: false, longitudMensaje: 7, forzado: true }
âš ï¸ Modo forzado manual activado: enviando mensaje independientemente del estado de activaciÃ³n del bot
ğŸ“± Enviando mensaje de texto forzado a 5212213647963: te amoo
ğŸ” [TARGET] Intento de envÃ­o a nÃºmero problemÃ¡tico: 5212213647963
ğŸ” [TARGET] Texto del mensaje: "te amoo"
ğŸ” [TARGET] NÃºmero corregido (quitando 1): 522213647963
ğŸ” [TARGET] NÃºmero limpio final: 522213647963
ğŸ” [TARGET] GUPSHUP_NUMBER: 15557033313
ğŸ” [TARGET] GUPSHUP_USERID: crxty1qflktvwvm7sodtrfe9dpvoowm1
ğŸ” [TARGET] API Key configurada: SÃ
ğŸ” [TARGET] URL de la API: https://api.gupshup.io/wa/api/v1/msg
ğŸ” [TARGET] Headers: {
  "Cache-Control": "no-cache",
  "Content-Type": "application/x-www-form-urlencoded",
  "apikey": "sk_58a31041fdeb4d98b9f0e073792a6e6b",
  "userid": "crxty1qflktvwvm7sodtrfe9dpvoowm1"
}
ğŸ” [TARGET] Datos del formulario: channel=whatsapp&source=15557033313&destination=522213647963&src.name=15557033313&message=%7B%22type%22%3A%22text%22%2C%22text%22%3A%22te+amoo%22%7D
ğŸ“¤ Enviando mensaje a GupShup para 522213647963: "te amoo..."
ğŸ” [TARGET] Intento 1/3
ğŸ” [TARGET] Respuesta de GupShup: {
  "status": "submitted",
  "messageId": "6f1f8f84-31c5-45bb-a9f7-66f5fafab0cb"
}
ğŸ” [TARGET] CÃ³digo de estado: 202
âœ… Mensaje enviado correctamente a 522213647963 (intento 1)
âœ… Mensaje de texto enviado correctamente a 5212213647963 (modo forzado)
